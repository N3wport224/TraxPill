<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PillTracker Pro</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        :root { --primary: #1a73e8; --danger: #d93025; --success: #34a853; --bg: #f8f9fa; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; }
        .container { max-width: 500px; margin: auto; padding: 20px; }
        
        /* Navigation */
        nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #ddd; z-index: 100; }
        nav button { background: none; border: none; color: #666; font-size: 12px; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        nav button.active { color: var(--primary); font-weight: bold; }

        /* Screens */
        .screen { display: none; }
        .screen.active { display: block; }

        /* UI Elements */
        .card { background: white; padding: 16px; border-radius: 12px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
        .input-row { display: flex; gap: 8px; margin-bottom: 20px; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        .btn-add { padding: 0 20px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: bold; }
        
        /* Pill Items */
        .pill-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; }
        .delete-btn { color: var(--danger); font-size: 13px; cursor: pointer; background: #fff5f5; border: 1px solid #ffcccc; padding: 4px 8px; border-radius: 4px; }
        
        /* Toggle Switch */
        .toggle { width: 46px; height: 24px; background: #e0e0e0; border-radius: 12px; position: relative; cursor: pointer; transition: 0.3s; }
        .toggle.on { background: var(--success); }
        .toggle-circle { width: 20px; height: 20px; background: white; border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .toggle.on .toggle-circle { left: 24px; }
        
        /* Calendar Grid */
        .history-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; margin-top: 10px; }
        .day-box { aspect-ratio: 1/1; background: #eee; border-radius: 6px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; }
        .day-box.done { background: var(--success); color: white; }
        .empty-state { text-align: center; color: #888; margin-top: 40px; }
    </style>
</head>
<body>

<div class="container">
    <div id="screen-add" class="screen active">
        <h2>My Medications</h2>
        <div class="input-row">
            <input type="text" id="pillInput" placeholder="Enter pill name...">
            <button class="btn-add" onclick="addPill()">Add</button>
        </div>
        <div id="manageList"></div>
    </div>

    <div id="screen-track" class="screen">
        <h2>Daily Tracker</h2>
        <p id="todayDate" style="color: #666;"></p>
        <div id="dailyList"></div>
    </div>

    <div id="screen-overview" class="screen">
        <h2>Monthly Progress</h2>
        <div id="overviewContent"></div>
    </div>
</div>

<nav>
    <button onclick="showScreen('add')" id="nav-add" class="active"><span>ðŸ’Š</span>Meds</button>
    <button onclick="showScreen('track')" id="nav-track"><span>âœ…</span>Track</button>
    <button onclick="showScreen('overview')" id="nav-overview"><span>ðŸ“Š</span>Stats</button>
</nav>

<script>
    // State initialization
    let pills = JSON.parse(localStorage.getItem('pills')) || [];
    let history = JSON.parse(localStorage.getItem('pillHistory')) || {};

    function showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.getElementById('screen-' + screenId).classList.add('active');
        document.getElementById('nav-' + screenId).classList.add('active');
        render();
    }

    function addPill() {
        const input = document.getElementById('pillInput');
        const name = input.value.trim();
        if(name && !pills.includes(name)) {
            pills.push(name);
            input.value = '';
            save();
        }
    }

    function deletePill(name) {
        if(confirm(`Remove ${name}?`)) {
            pills = pills.filter(p => p !== name);
            save();
        }
    }

    function togglePill(pillName) {
        const today = new Date().toISOString().split('T')[0];
        if (!history[today]) history[today] = {};
        history[today][pillName] = !history[today][pillName];
        save();
    }

    function save() {
        localStorage.setItem('pills', JSON.stringify(pills));
        localStorage.setItem('pillHistory', JSON.stringify(history));
        render();
    }

    function render() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('todayDate').innerText = new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });

        // 1. Manage Screen
        const manageList = document.getElementById('manageList');
        if (pills.length === 0) {
            manageList.innerHTML = `<div class="empty-state">No pills added yet.</div>`;
        } else {
            manageList.innerHTML = pills.map(p => `
                <div class="card pill-row">
                    <span>${p}</span>
                    <button class="delete-btn" onclick="deletePill('${p}')">Delete</button>
                </div>
            `).join('');
        }

        // 2. Daily Tracking Screen
        const dailyList = document.getElementById('dailyList');
        if (pills.length === 0) {
            dailyList.innerHTML = `<div class="empty-state">Add meds in the first tab to track them here.</div>`;
        } else {
            dailyList.innerHTML = pills.map(p => {
                const isTaken = history[today] && history[today][p];
                return `
                    <div class="card pill-row">
                        <strong>${p}</strong>
                        <div class="toggle ${isTaken ? 'on' : ''}" onclick="togglePill('${p}')">
                            <div class="toggle-circle"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 3. Overview Screen (Past 14 days)
        const overview = document.getElementById('overviewContent');
        if (pills.length === 0) {
            overview.innerHTML = `<div class="empty-state">No data to display.</div>`;
        } else {
            overview.innerHTML = pills.map(p => {
                let boxes = '';
                for(let i=13; i>=0; i--) {
                    const d = new Date();
                    d.setDate(d.getDate() - i);
                    const dateStr = d.toISOString().split('T')[0];
                    const taken = history[dateStr] && history[dateStr][p];
                    const dayName = d.toLocaleDateString('en-US', {weekday: 'narrow'});
                    boxes += `<div class="day-box ${taken ? 'done' : ''}"><div>${dayName}</div><b>${d.getDate()}</b></div>`;
                }
                return `
                    <div class="card">
                        <strong style="display:block; margin-bottom:10px;">${p}</strong>
                        <div class="history-grid">${boxes}</div>
                    </div>
                `;
            }).join('');
        }
    }

    // Initial render
    render();
</script>
</body>
</html>
